<div class="user-list-container">
  <div class="header">
    <h2>Liste des utilisateurs</h2>
    @if (!showForm()) {
      <button class="btn-add" (click)="onAddUser()">+ Ajouter un utilisateur</button>
    }
  </div>

  @if (showForm()) {
    <app-user-form
      [user]="editingUser()"
      (saved)="onFormSaved()"
      (cancelled)="onFormCancelled()"
    />
  }

  @if (loading()) {
    <div class="loading">Chargement...</div>
  }

  @if (error() && !showForm()) {
    <div class="error">{{ error() }}</div>
  }

  @if (!loading() && !error() && !showForm() && !showReports()) {
    @if (users().length === 0) {
      <div class="empty">Aucun utilisateur trouvÃ©</div>
    } @else {
      <div class="selection-controls">
        <div class="selection-info">
          <label class="select-all-checkbox">
            <input 
              type="checkbox" 
              [checked]="areAllActiveSelected()"
              [indeterminate]="getSelectedCount() > 0 && !areAllActiveSelected()"
              (change)="toggleSelectAll()"
            />
            <span>SÃ©lectionner tous les utilisateurs actifs ({{ getSelectedCount() }}/{{ getActiveUsersCount() }})</span>
          </label>
        </div>
        <div class="report-actions">
          <button 
            class="btn-generate-selected" 
            [disabled]="getSelectedCount() === 0"
            (click)="generateReportsForSelected()"
            title="GÃ©nÃ©rer les rapports pour les utilisateurs sÃ©lectionnÃ©s"
          >
            ğŸ“Š GÃ©nÃ©rer les rapports sÃ©lectionnÃ©s
          </button>
          <button 
            class="btn-generate-all-active" 
            [disabled]="getActiveUsersCount() === 0"
            (click)="generateReportsForAllActive()"
            title="GÃ©nÃ©rer les rapports pour tous les utilisateurs actifs"
          >
            ğŸ“Š GÃ©nÃ©rer tous les rapports (actifs)
          </button>
        </div>
      </div>

      <ul class="user-list">
        @for (user of users(); track user.id) {
          <li class="user-item">
            <label class="user-checkbox">
              <input 
                type="checkbox" 
                [checked]="isUserSelected(user.id)"
                [disabled]="!user.isActive"
                (change)="toggleUserSelection(user.id); $event.stopPropagation()"
                (click)="$event.stopPropagation()"
              />
            </label>
            <a [routerLink]="['/users', user.id]" class="user-link">
              <span class="user-name">{{ user.name }}</span>
              <span class="user-status" [class.active]="user.isActive" [class.inactive]="!user.isActive">
                {{ user.isActive ? 'Actif' : 'Inactif' }}
              </span>
              <span class="user-id">{{ user.id }}</span>
            </a>
            <div class="user-actions">
              <button class="btn-edit" (click)="onEditUser(user.id); $event.stopPropagation()" title="Modifier">
                âœï¸
              </button>
              <button class="btn-delete" (click)="onDeleteUser(user.id, user.name); $event.stopPropagation()" title="Supprimer">
                ğŸ—‘ï¸
              </button>
            </div>
          </li>
        }
      </ul>
    }
  }

  @if (showReports()) {
    <div class="reports-container">
      <div class="reports-header">
        <h2>Rapports de dÃ©penses mensuels</h2>
        <div class="reports-header-actions">
          <button class="btn-print-all" (click)="printAllReports()">ğŸ–¨ï¸ Imprimer tous</button>
          <button class="btn-close-reports" (click)="closeReports()">â† Retour Ã  la liste</button>
        </div>
      </div>

      @if (generatingReports()) {
        <div class="loading">GÃ©nÃ©ration des rapports...</div>
      }

      @if (reports().length === 0 && !generatingReports()) {
        <div class="empty">Aucun rapport disponible</div>
      }

      @for (report of reports(); track report.userId) {
        <div class="report-wrapper">
          <app-expense-report 
            [userId]="report.userId" 
            [year]="reportYear()"
            [month]="reportMonth()"
          />
        </div>
      }
    </div>
  }
</div>

